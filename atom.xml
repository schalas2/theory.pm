<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[theory.pm]]></title>
  <link href="http://theory.pm/atom.xml" rel="self"/>
  <link href="http://theory.pm/"/>
  <updated>2013-08-15T19:14:14+02:00</updated>
  <id>http://theory.pm/</id>
  <author>
    <name><![CDATA[David E. Wheeler]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
    <entry>
      




<title type="html"><![CDATA[Mopping the Moose &rarr;]]></title>
<link href="http://blogs.perl.org/users/stevan_little/2013/08/mapping-the-mop-to-moose.html"/>
<updated>2013-08-15T13:44:00+02:00</updated>
<id>http://theory.pm/mop/2013/08/15/mopping-the-moose</id>

      <content type="html"><![CDATA[<p>Stevan Little:</p>

<blockquote><p>I spent much of last week on vacation with the family so very little actual
coding got done on the <a href="https://github.com/stevan/p5-mop-redux">p5-mop</a>, but instead I did a lot of thinking. My
next major goal for the <a href="https://github.com/stevan/p5-mop-redux">p5-mop</a> is to port a module written in <a href="https://metacpan.org/module/Moose">Moose</a>, in
particular, one that uses many different <a href="https://metacpan.org/module/Moose">Moose</a> features. The module I have
chosen to port is <a href="https://metacpan.org/module/Bread::Board">Bread::Board</a> and I chose it for two reasons; first, it
was the first real module that I wrote using <a href="https://metacpan.org/module/Moose">Moose</a> and second, it makes
heavy use of a lot of <a href="https://metacpan.org/module/Moose">Moose</a>&rsquo;s features.</p></blockquote>

<p>I&rsquo;m so happy to see Stevan making progress on the Perl 5 MOP again.</p>
<p><a rel="bookmark" href="http://theory.pm/mop/2013/08/15/mopping-the-moose/">§ Permalink</a></p>]]></content>
    </entry>
  
    <entry>
      




<title type="html"><![CDATA[A Perl Blog]]></title>
<link href="http://theory.pm/blog/2013/07/26/a-perl-blog/"/>
<updated>2013-07-26T18:08:00+02:00</updated>
<id>http://theory.pm/blog/2013/07/26/a-perl-blog</id>

      <content type="html"><![CDATA[<p>I have been unsatisfied with <a href="http://justatheory.com/">Just a Theory</a> for some time. I started that
blog in 2004 more or less for fun, thinking it would be my permanent home on
the internet. And it has been. But the design, while okay in 2004, is just
awful by today&rsquo;s standards. A redesign is something I have planned to do for
quite some time.</p>

<p>I had also been thinking about my audience. Or rather, audiences. I&rsquo;ve blogged
about many things, but while a few dear family members might want to read
everything I ever post, most folks, I think, are interested in only a subset
of topics. Readers of <a href="http://justatheory.com/">Just a Theory</a> came for posts about Perl, or
PostgreSQL, or culture, travel, or politics. But few came for all those
topics, in my estimation.</p>

<p>More recently, a whole bunch of top-level domains have opened up, often with
the opportunity for anyone to register them. I was lucky enough to snag
<code>theory.pm</code> and <code>theory.pl</code>, thinking that perhaps I would create a site just
for blogging about Perl. I also nabbed <code>theory.so</code>, which I might dedicate to
database-related blogging, and <code>theory.me</code>, which would be my personal blog
(travel, photography, cultural essays, etc.).</p>

<p>And then there is <a href="http://octopress.org">Octopress</a>. A blogging engine for hackers. Perfect for me.
Hard to imagine something more appropriate (unless it was written in Perl). It
seemed like a good opportunity to partition my online blogging.</p>

<p>So here we are with my first partition. <a href="http://theory.pm/">theory.pm</a> is a Perl blog. Seemed
like the perfect name. I fiddled with it off and on for a few months, often
following <a href="http://mattgemmell.com/2013/05/22/designing-blogs-for-readers/">Matt Gemmell&rsquo;s Advice</a>, and I&rsquo;m really happy with it. The
open-source fonts <a href="https://github.com/adobe/source-sans-pro">Source Sans Pro</a> and <a href="https://github.com/adobe/source-code-pro">Source Code Pro</a>, from Adobe, look
great. The source code examples are beautifully marked up and displayed using
the <a href="http://ethanschoonover.com/solarized">Solarized</a> color scheme (though presentation varies in feed readers).
Better still, it&rsquo;s equally attractive and readable on computers, tablets and
phones, thanks to the foundation laid by Aron Cedercrantz’s <a href="https://github.com/rastersize/BlogTheme">BlogTheme</a>.</p>

<p>I expect to fork this code to create a database blog soon, and then perhaps
put together a personal blog. Maybe the personal blog will provide link posts
for posts on the other sites, so that if anyone really wants to read
everything, they can. I haven&rsquo;t decided yet.</p>

<p>In the meantime, now that I have a dedicated Perl blog, I guess I&rsquo;ll have to
start writing more Perl-related stuff. I&rsquo;m starting with some posts about the
state of exception handling in Perl 5, the first of which is <a href="http://theory.pm/exceptions/2013/07/26/trying-times/">already up</a>. Stay
tuned for more.</p>
]]></content>
    </entry>
  
    <entry>
      




<title type="html"><![CDATA[Trying Times]]></title>
<link href="http://theory.pm/exceptions/2013/07/26/trying-times/"/>
<updated>2013-07-26T15:20:00+02:00</updated>
<id>http://theory.pm/exceptions/2013/07/26/trying-times</id>

      <content type="html"><![CDATA[<p>Exception handling is a bit of a pain in Perl. Traditionally, we use
<code>eval {}</code>:</p>

<figure class='code'><figcaption><span>Perl eval</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='perl'><span class='line'><span class="nb">eval</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">foo</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="k">if</span> <span class="p">(</span><span class="k">my</span> <span class="nv">$err</span> <span class="o">=</span> <span class="vg">$@</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="c1"># Inspect $err…</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The use of the <code>if</code> block is a bit unfortunate; worse is the use of the global
<code>$@</code> variable, which has inflicted unwarranted pain on developers over the
years<sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup>. Many Perl hackers put <a href="https://metacpan.org/module/Try::Tiny">Try::Tiny</a> to work to circumvent these
shortcomings:</p>

<figure class='code'><figcaption><span>Try::Tiny</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='perl'><span class='line'><span class="n">try</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">foo</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span> <span class="n">catch</span> <span class="p">{</span>
</span><span class='line'>    <span class="c1"># Inspect $_…</span>
</span><span class='line'><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>


<p>Alas, Try::Tiny introduces its own idiosyncrasies, particularly its use of
subroutine references rather than blocks. While a necessity of a pure-Perl
implementation, it prevents <code>return</code>ing from the calling context. One must
work around this deficiency by <a href="http://stackoverflow.com/a/10366209/79202">checking return values</a>:</p>

<figure class='code'><figcaption><span>Return from Try::Tiny</span><a href='http://stackoverflow.com/a/10366209/79202'>More Gotchas</a></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='perl'><span class='line'><span class="k">my</span> <span class="nv">$rv</span> <span class="o">=</span> <span class="n">try</span> <span class="p">{</span>
</span><span class='line'>   <span class="n">f</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span> <span class="n">catch</span> <span class="p">{</span>
</span><span class='line'>   <span class="c1"># …</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$rv</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>   <span class="k">return</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>I can&rsquo;t tell you how often this quirk burns me.</p>

<!-- more -->


<p>Sadly, there is a deeper problem then syntax: Just what, exactly, is an
exception? How does one determine the exceptional condition, and what can be
done about it? It might be a string. The string might be localized. It might
be an <a href="https://metacpan.org/module/Exception::Class">Exception::Class</a> object, or a <a href="https://metacpan.org/module/Throwable">Throwable</a> object, or a simple array
reference. Or any other value a Perl scalar can hold. This lack of specificity
requires careful handling of exceptions:</p>

<figure class='code'><figcaption><span>Exceptional Conditions</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='perl'><span class='line'><span class="k">if</span> <span class="p">(</span><span class="k">my</span> <span class="nv">$err</span> <span class="o">=</span> <span class="vg">$@</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="nb">ref</span> <span class="nv">$err</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="nb">eval</span> <span class="p">{</span> <span class="nv">$err</span><span class="o">-&gt;</span><span class="n">isa</span><span class="p">(</span><span class="s">&#39;Exception::Class&#39;</span><span class="p">)</span> <span class="p">})</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">if</span> <span class="p">(</span> <span class="nv">$err</span><span class="o">-&gt;</span><span class="n">isa</span><span class="p">(</span><span class="s">&#39;SomeException&#39;</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                <span class="c1"># …</span>
</span><span class='line'>            <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span> <span class="nv">$err</span><span class="o">-&gt;</span><span class="n">isa</span><span class="p">(</span><span class="s">&#39;SomeException&#39;</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                <span class="c1"># …</span>
</span><span class='line'>            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>                <span class="c1"># …</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nb">eval</span> <span class="p">{</span> <span class="nv">$err</span><span class="o">-&gt;</span><span class="n">DOES</span><span class="p">(</span><span class="s">&#39;Throwable&#39;</span><span class="p">)</span> <span class="p">})</span> <span class="p">{</span>
</span><span class='line'>            <span class="c1"># …</span>
</span><span class='line'>        <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span> <span class="nb">ref</span> <span class="nv">$err</span> <span class="ow">eq</span> <span class="s">&#39;ARRAY&#39;</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="c1"># …</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span> <span class="nv">$err</span> <span class="o">=~</span><span class="sr"> /DBI/</span> <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="c1"># …</span>
</span><span class='line'>        <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span> <span class="nv">$err</span> <span class="o">=~</span><span class="sr"> /cannot open &#39;([^&#39;]+)&#39;/</span> <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="c1"># …</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Not every exception handler requires so many conditions, but I have certainly
exercised all these approaches. Usually my exception handlers accrete
condition as users report new, unexpected errors.</p>

<p>That&rsquo;s not all. My code frequently requires parsing information out of a
string error. Here&rsquo;s an example from <a href="https://github.com/pgxn/pgxn-manager/">PGXN::Manager</a>:</p>

<figure class='code'><figcaption><span>Exception Parsing</span><a href='https://github.com/pgxn/pgxn-manager/blob/master/lib/PGXN/Manager/Distribution.pm#L123'>Source</a></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='perl'><span class='line'><span class="n">try</span> <span class="p">{</span>
</span><span class='line'>    <span class="nv">$self</span><span class="o">-&gt;</span><span class="n">distmeta</span><span class="p">(</span><span class="n">decode_json</span> <span class="nb">scalar</span> <span class="nv">$member</span><span class="o">-&gt;</span><span class="n">contents</span> <span class="p">);</span>
</span><span class='line'><span class="p">}</span> <span class="n">catch</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">my</span> <span class="nv">$f</span> <span class="o">=</span> <span class="nb">quotemeta</span> <span class="n">__FILE__</span><span class="p">;</span>
</span><span class='line'>    <span class="p">(</span><span class="k">my</span> <span class="nv">$err</span> <span class="o">=</span> <span class="nv">$_</span><span class="p">)</span> <span class="o">=~</span> <span class="sr">s/\s+at\s+$f.+//ms</span><span class="p">;</span>
</span><span class='line'>    <span class="nv">$self</span><span class="o">-&gt;</span><span class="n">error</span><span class="p">([</span>
</span><span class='line'>        <span class="s">&#39;Cannot parse JSON from “[_1]”: [_2]&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="nv">$member</span><span class="o">-&gt;</span><span class="n">fileName</span><span class="p">,</span>
</span><span class='line'>        <span class="nv">$err</span>
</span><span class='line'>    <span class="p">]);</span>
</span><span class='line'>    <span class="k">return</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span> <span class="ow">or</span> <span class="k">return</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">return</span> <span class="nv">$self</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>When <a href="https://metacpan.org/module/JSON">JSON</a> throws an exception on invalid JSON, the code must catch that
exception to show the user. The user cares not at all what file threw the
exception, nor the line number. The code must <em>strip that stuff out</em> before
passing the original message off to a localizing error method.</p>

<p>Gross.</p>

<p>It&rsquo;s time to end this. A forthcoming post will propose a plan for adding
proper exception handling to the core Perl language, including exception
objects and an official <code>try</code>/<code>catch</code> syntax.</p>

<!-- notes -->



<div class="footnotes">
<hr/>
<ol>
<li id="fn:1">
<p>In fairness much of the <code>$@</code> pain has been addressed [in Perl 5.14].<a href="#fnref:1" rev="footnote">&#8617;</a></p></li>
</ol>
</div>

]]></content>
    </entry>
  
</feed>
